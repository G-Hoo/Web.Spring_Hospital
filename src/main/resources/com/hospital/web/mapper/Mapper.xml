<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hospital.web.mapper.Mapper" >
 	<resultMap id="Patient" type="com.hospital.web.domain.Patient">
        <id property="id" column="pat_id"/>
        <result property="nurID" column="nur_id"/>
        <result property="docID" column="doc_id"/>
        <result property="pass" column="pat_pass"/>
        <result property="name" column="pat_name"/>
        <result property="gen" column="pat_gen"/>
        <result property="jumin" column="pat_jumin"/>
        <result property="addr" column="pat_addr"/>
        <result property="phone" column="pat_phone"/>
        <result property="email" column="pat_email"/>
        <result property="job" column="pat_job"/>
    </resultMap>
    <resultMap id="Doctor" type="com.hospital.web.domain.Doctor">
        <id property="id" column="doc_id"/>
        <result property="pass" column="doc_pass"/>
        <result property="name" column="doc_name"/>
        <result property="gen" column="doc_gen"/>
        <result property="phone" column="doc_phone"/>
        <result property="email" column="doc_email"/>
        <result property="major" column="major_treat"/>
        <result property="position" column="doc_position"/>
    </resultMap>
    <resultMap id="Nurse" type="com.hospital.web.domain.Nurse">
        <id property="id" column="nur_id"/>
        <result property="pass" column="nur_pass"/>
        <result property="name" column="nur_name"/>
        <result property="gen" column="nur_gen"/>
        <result property="phone" column="nur_phone"/>
        <result property="email" column="nur_email"/>
        <result property="major" column="major_job"/>
        <result property="position" column="nur_position"/>
    </resultMap>
    
  <insert id="registPatient">
  	INSERT INTO ${group}(pat_id,pat_pass,pat_name,pat_gen,pat_phone,pat_email,pat_job,pat_jumin,pat_addr,doc_id,nur_id) 
  	VALUES (#{id}, #{pass}, #{name}, #{gen}, #{phone}, #{email}, #{job}, #{jumin}, #{addr}, #{docID}, #{nurID})
  </insert>
    
  <insert id="registDoctor">
  	INSERT INTO ${group}(doc_id,doc_pass,doc_name,doc_gen,doc_phone,doc_email,major_treat,doc_position) 
  	VALUES (#{id}, #{pass}, #{name}, #{gen}, #{phone}, #{email}, #{job}, #{major}, #{position})
  </insert>  
  
  <insert id="registNurse">
  	INSERT INTO ${group}(nur_id,nur_pass,nur_name,nur_gen,nur_phone,nur_email,major_job,nur_position) 
  	VALUES (#{id}, #{pass}, #{name}, #{gen}, #{phone}, #{email}, #{job}, #{major}, #{position})
  </insert>
    
  <select id="findPatient" resultMap="Patient" parameterType="hashMap">
    	SELECT * FROM ${group} WHERE ${key} = #{value}
    	<!-- $는 싱글쿼터 필요없는 부분 / #은 싱글쿼터 필요한 부분 -->
  </select>
  
  <select id="findDoctor" resultMap="Doctor" parameterType="hashMap">
    	SELECT * FROM ${group} WHERE ${key} = #{value}
    	
  </select>

  <select id="findNurse" resultMap="Nurse" parameterType="hashMap">
    	SELECT * FROM ${group} WHERE ${key} = #{value}
    	
  </select>

  <select id="findPatients" resultMap="Patient" parameterType="hashMap">
    	SELECT * FROM ${group} 
    	WHERE 
    	<if test="name != null">
   		pat_name LIKE #{value}
  		</if>
  		<if test="gen != null">
    	pat_gen LIKE #{value}
  		</if>
  		<if test="docID != null">
    	doc_id LIKE #{value}
  		</if>
  		<if test="nurID != null">
    	nur_id LIKE #{value}
  		</if>
  </select>
  
   <select id="findDoctors" resultMap="Doctor" parameterType="hashMap">
    	SELECT * FROM ${group} 
    	WHERE 
    	<if test="name != null">
   		doc_name LIKE #{value}
  		</if>
  		<if test="gen != null">
    	doc_gen LIKE #{value}
  		</if>
  		<if test="major != null">
    	major_treat LIKE #{value}
  		</if>
  </select>

   <select id="findNurses" resultMap="Nurse" parameterType="hashMap">
    	SELECT * FROM ${group} 
    	WHERE 
    	<if test="name != null">
   		nur_name LIKE #{value}
  		</if>
  		<if test="gen != null">
    	nur_gen LIKE #{value}
  		</if>
  		<if test="major != null">
    	major_job LIKE #{value}
  		</if>
  </select>

  <select id="count" resultType="int">
    	SELECT COUNT(*) FROM ${group}
  </select>
  
  <select id="exist" resultType="int" parameterType="hashMap">
    	SELECT COUNT(*) FROM ${group} WHERE ${idType}=#{id}
  </select>
  
  <update id="updatePatient">
	  UPDATE ${group} SET
	    pat_pass = #{pass},
	    pat_phone = #{phone},
	    pat_email = #{email}
	  WHERE pat_id = #{id}
</update>
  
  <update id="updateDoctor">
  update ${group}
    <set>
      <if test="username != null">username=#{username},</if>
      <if test="password != null">password=#{password},</if>
      <if test="email != null">email=#{email},</if>
      <if test="bio != null">bio=#{bio}</if>
    </set>
  WHERE ${key}=#{value}
  </update>
  
  <update id="updateNurse">
  update ${group}
    <set>
      <if test="username != null">username=#{username},</if>
      <if test="password != null">password=#{password},</if>
      <if test="email != null">email=#{email},</if>
      <if test="bio != null">bio=#{bio}</if>
    </set>
  WHERE ${key}=#{value}
  </update>
  
  <delete id="delete" parameterType="hashMap">
		DELETE 
		FROM ${group} 
		WHERE ${key} = #{value}
</delete>
</mapper>